{% extends "superadmin/adminbase.html" %}
{% load static %}
{% block title %}Products - Superadmin{% endblock %}
{% block content %}
<!-- main -->
<main class="main-content-wrapper">
	<div class="container">
		<div class="row mb-8">
			<div class="col-md-12">
				<!-- page header -->
				<div class="d-md-flex justify-content-between align-items-center">
					<div>
						<h2>Products</h2>
						<!-- breacrumb -->
						<nav aria-label="breadcrumb">
							<ol class="breadcrumb mb-0">
								<li class="breadcrumb-item"><a href="{% url 'admin-home' %}"
										class="text-inherit">Dashboard</a></li>
								<li class="breadcrumb-item active" aria-current="page">Product Categories</li>
							</ol>
						</nav>
					</div>
				</div>
			</div>
		</div>
		<div class="mb-4 d-flex justify-content-end gap-3">
			<a href="{% url 'download_product_template_global' %}" class="btn btn-success btn-sm">
				ðŸ“¥ Download Excel Format
			</a>
			<form method="POST" action="{% url 'upload_product_excel_global' %}" enctype="multipart/form-data"
				class="d-inline">
				{% csrf_token %}
				<input type="file" name="excel_file" accept=".xlsx,.xls" required
					class="form-control form-control-sm d-inline w-auto" />
				<button type="submit" class="btn btn-primary btn-sm">ðŸ“¤ Upload Excel</button>
			</form>
		</div>
		<section class="my-lg-14 my-8">
			<!-- category -->
			<div class="container">
				<!-- row -->
				<div class="row">
					<div class="col-12">
						<div class="mb-8">
							<!-- heading -->
							<h3 class="mb-0">Add Products by Category</h3>
						</div>
					</div>
				</div>
				<!-- row -->
				<div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 row-cols-xxl-6 g-6">
					<!-- col -->
					{% for category in categories %}
					<div class="col">

						<a href="{% url 'add-productcategory' category.id %}" class="text-decoration-none text-inherit">
							<!-- card -->
							<div class="card card-product">
								<div class="card-body text-center py-8">
									<!-- img -->
									<img src="/media/{{ category.image }}" alt="{{ category.name }}" class="mb-3"
										style="width: 100%;" />

									<!-- text -->
									<div class="text-truncate">{{ category.name }}</div>
								</div>
							</div>
						</a>
					</div>
					{% endfor %}
				</div>
			</div>
		</section>
	</div>
</main>

<!-- Upgrade Modal -->
<div class="modal fade" id="upgradePlanModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content p-4">
      <div class="modal-header border-0">
        <h5 class="modal-title fw-bold"> Upgrade Your Plan</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p class="mb-3">Youâ€™ve reached your product upload limit. Choose a plan below:</p>

        {% for p in all_plans %}
        <div class="border rounded-3 p-3 mb-3">
          <h6 class="fw-semibold text-primary">{{ p.plan_name }}</h6>
          <p class="mb-1"><i class="fa fa-credit-card-alt" aria-hidden="true"></i> Price: â‚¹{{ p.price }}</p>
          <p class="mb-1"><i class="fa fa-shopping-cart" aria-hidden="true"></i> Product Limit: {{ p.product_limit }}</p>
          {% if p.description %}
            <p class="small text-muted">{{ p.description }}</p>
          {% endif %}
          <a href="{% url 'payment' %}?plan_id={{ p.id }}" class="btn btn-outline-danger btn-sm mt-2 w-100">
            Select {{ p.plan_name }}
          </a>
        </div>
        {% empty %}
        <p class="text-muted">No plans available right now.</p>
        {% endfor %}
      </div>
    </div>
  </div>
</div>


<script>
document.addEventListener("DOMContentLoaded", function() {
    {% if messages %}
    {% for message in messages %}
      {% comment %}
      Sometimes message.message doesnâ€™t render as plain text â€” use striptags to match.
      {% endcomment %}
      {% if "limit" in message.message|striptags or "plan" in message.message|striptags %}
        const modalEl = document.getElementById('upgradePlanModal');
        if (modalEl) {
          const modal = new bootstrap.Modal(modalEl);
          modal.show();
        }
      {% endif %}
    {% endfor %}
    {% endif %}
});
</script>


{% endblock %}