{% extends "base.html" %}
{% load static %}
{% load custom_tags %}
{% block title %} Shop Grid {% endblock %}
{% block content %}

<main>
   <div class="mt-8 mb-lg-14 mb-8">
      <div class="container">
         <div class="row gx-10">
            <!-- Sidebar -->
            <aside class="col-lg-3 col-md-4 mb-6 mb-md-0">
               <div class="offcanvas offcanvas-start offcanvas-collapse w-md-50" tabindex="-1" id="offcanvasCategory"
                  aria-labelledby="offcanvasCategoryLabel">
                  <div class="offcanvas-header d-lg-none">
                     <h5 class="offcanvas-title" id="offcanvasCategoryLabel">Filter</h5>
                     <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                  </div>
                  <div class="offcanvas-body ps-lg-2 pt-lg-0">
                     <!-- Category filter -->
                     <div class="mb-8">
                        <h5 class="mb-3">Categories</h5>
                        <ul class="nav nav-category" id="categoryCollapseMenu">
                           <li class="nav-item border-bottom w-100">
                              <a href="#" class="nav-link collapsed" data-bs-toggle="collapse"
                                 data-bs-target="#categoryFlushOne" aria-expanded="true"
                                 aria-controls="categoryFlushOne">
                                 {{ category.name }}
                                 <i class="feather-icon icon-chevron-right"></i>
                              </a>
                              <div id="categoryFlushOne" class="accordion-collapse collapse show"
                                 data-bs-parent="#categoryCollapseMenu">
                                 <div>
                                    <ul class="nav flex-column ms-3">
                                       {% for sub in subcategories %}
                                       <li class="nav-item">
                                          <a href="{% url 'category-products' category.id %}?sub={{ sub.id }}"
                                             class="nav-link {% if request.GET.sub|default:'' == sub.id|stringformat:'s' %}text-primary fw-bold{% endif %}">
                                             {{ sub.name }}
                                          </a>
                                       </li>
                                       {% empty %}
                                       <li class="nav-item">
                                          <span class="nav-link text-muted small">No subcategories</span>
                                       </li>
                                       {% endfor %}
                                    </ul>
                                 </div>
                              </div>
                           </li>
                        </ul>
                     </div>

                     <!-- Filters placeholder -->
                     <div class="mb-8">
                        <h5 class="mb-3">Filters</h5>
                        <p class="text-muted small mb-0">Coming soon...</p>
                     </div>
                  </div>
               </div>
            </aside>

            <!-- Product Grid -->
            <section class="col-lg-9 col-md-12">
               <!-- Category Header -->
               <div class="card mb-4 bg-light border-0">
                  <div class="card-body p-9">
                     <h2 class="mb-0 fs-1">{{ category.name }}</h2>
                  </div>
               </div>

               <!-- Toolbar -->
               <div class="d-lg-flex justify-content-between align-items-center">
                  <div class="mb-3 mb-lg-0">
                     <p class="mb-0">
                        <span class="text-dark">{{ total }}</span>
                        Products found
                     </p>
                  </div>

                  <div class="d-md-flex justify-content-between align-items-center">
                     <div class="d-flex align-items-center justify-content-between">
                        <div class="ms-2 d-lg-none">
                           <a class="btn btn-outline-gray-400 text-muted" data-bs-toggle="offcanvas"
                              href="#offcanvasCategory" role="button" aria-controls="offcanvasCategory">
                              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round" class="feather feather-filter me-2">
                                 <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                              </svg>
                              Filters
                           </a>
                        </div>
                     </div>

                     <div class="d-flex mt-2 mt-lg-0">
                        <!-- Show limit -->
                        <div class="me-2 flex-grow-1">
                           <select class="form-select" onchange="location = this.value;">
                              <option value="?limit=12" {% if limit == 12 %}selected{% endif %}>Show: 12</option>
                              <option value="?limit=24" {% if limit == 24 %}selected{% endif %}>Show: 24</option>
                              <option value="?limit=48" {% if limit == 48 %}selected{% endif %}>Show: 48</option>
                           </select>
                        </div>

                        <!-- Sort -->
                        <div>
                           <select class="form-select" onchange="location = this.value;">
                              <option value="?sort=" {% if not sort %}selected{% endif %}>Sort by: Featured</option>
                              <option value="?sort=price_low" {% if sort == 'price_low' %}selected{% endif %}>Price: Low
                                 to High</option>
                              <option value="?sort=price_high" {% if sort == 'price_high' %}selected{% endif %}>Price:
                                 High to Low</option>
                           </select>
                        </div>
                     </div>
                  </div>
               </div>

               <!-- Products -->
               <div class="row g-4 row-cols-xl-4 row-cols-lg-3 row-cols-md-3 row-cols-2 mt-2 align-items-stretch">
                  {% for product in products %}
                  <div class="col">
                     <div class="card card-product">
                        <div class="card-body">
                           <div class="text-center position-relative">
                              {% if product.sale_price and product.sale_price|floatformat:2 < product.price|floatformat:2 %} <div class="position-absolute top-0 start-0"></div>
                                <div class="position-absolute top-0 start-0">
                                 <span class="badge bg-danger">Sale</span>
                           </div>
                              {% endif %}
                           <a href="#!" data-bs-toggle="modal" data-bs-target="#quickViewModal">
                              <img src="/media/{{ product.main_image }}" alt="{{ product.title }}"
                                 class="mb-3 img-fluid" />
                           </a>
                           <div class="card-product-action">
                              <a href="#!" class="btn-action" data-bs-toggle="modal" data-bs-target="#quickViewModal">
                                 <i class="bi bi-eye" data-bs-toggle="tooltip" title="Quick View"></i>
                              </a>
                              <a href="#!" class="btn-action" data-bs-toggle="tooltip" title="Wishlist"><i
                                    class="bi bi-heart"></i></a>
                           </div>
                        </div>

                        <div class="text-small mb-1">
                           <small class="text-muted">{{ product.subcategory_name|default:category.name }}</small>
                        </div>
                        <h6 class="fw-semibold mt-2 mb-1 product-title"
    data-bs-toggle="tooltip"
    data-bs-title="{{ product.title }}">
                           <a href="#!" class="text-inherit text-decoration-none">{{ product.title }}</a>
                        </h2>

                        <div class="d-flex justify-content-between align-items-center mt-3">
                           <div>
                              <span class="text-dark">₹{{ product.sale_price|default:product.price }}</span>
                              {% if product.sale_price %}
                              <span class="text-decoration-line-through text-muted">₹{{ product.price }}</span>
                              {% endif %}
                           </div>
                           <div>
                              <a href="#!" class="btn btn-primary btn-sm">
                                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="feather feather-plus">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                 </svg>
                                 Add
                              </a>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               {% empty %}
               <div class="col-12 text-center text-muted py-5">
                  <h5>No products found for this category.</h5>
               </div>
               {% endfor %}
         </div>


         </section>
      </div>
   </div>
   </div>
</main>


                  


<style>
   /* ✅ Maintain uniform product card size */
   .card.card-product {
      height: 100%;
      display: flex;
      flex-direction: column;
   }

   .card.card-product .card-body {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      height: 100%;
   }

   /* ✅ Fix inconsistent image height */
   .card.card-product img {
      width: 100%;
      height: 220px;
      /* adjust height as needed (180–250px recommended) */
      object-fit: cover;
      border-radius: 0.25rem;
   }

   /* ✅ Consistent button area alignment */
   .card.card-product .btn {
      min-width: 70px;
   }

   /* ✅ Equal spacing between cards */
   .row .col {
      display: flex;
   }

.product-title {
  font-size: 1rem;
  font-weight: 600;
  margin: 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  display: block;
  width: 100%;
  cursor: pointer;
}

/* 🎨 Custom Bootstrap Tooltip Styling */
.custom-tooltip.bs-tooltip-top .tooltip-arrow::before {
  border-top-color: #fff !important;
}
.custom-tooltip.bs-tooltip-bottom .tooltip-arrow::before {
  border-bottom-color: #fff !important;
}
.custom-tooltip .tooltip-inner {
  background-color: #fff !important;   /* white tooltip background */
  color: #222 !important;              /* dark readable text */
  font-size: 0.9rem;
  font-weight: 500;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  border-radius: 6px;
  padding: 6px 10px;
  max-width: 250px;
  text-align: center;
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl, {
      customClass: 'custom-tooltip',
      placement: 'top',     // You can use 'bottom', 'left', or 'right'
      delay: { show: 150, hide: 50 }
    });
  });
});
</script>

{% endblock %}